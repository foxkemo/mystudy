非常好 👍
你现在已经了解了存储过程的语法和流程控制，接下来这个问题——
👉 **「存储过程（Stored Procedure）」与「存储函数（Stored Function）」的区别与联系**
是 MySQL 进阶中最重要的概念之一。

---

# 🧩 一、基本概念

| 项目             | 存储过程（Procedure）               | 存储函数（Function）               |
| -------------- | ----------------------------- | ---------------------------- |
| 定义             | 一组 SQL 语句的封装，用来执行某种操作（可有输入输出） | 类似编程中的函数，有返回值，通常用于计算并返回结果    |
| 调用方式           | 用 `CALL` 调用                   | 可在 SQL 中直接使用                 |
| 返回值            | 可通过 `OUT` 或 `INOUT` 参数返回多个结果  | 只能返回一个值（`RETURN`）            |
| 用途             | 执行业务逻辑、批量处理、事务控制              | 计算并返回值（如平均数、状态等）             |
| 是否允许事务控制       | ✅ 可以（BEGIN/COMMIT/ROLLBACK）   | ❌ 不可以（函数中禁止事务操作）             |
| 可否在 SELECT 中使用 | ❌ 不可                          | ✅ 可直接使用（如 `SELECT myfunc()`） |

---

# 🧠 二、语法区别

## ✅ 1️⃣ 创建存储过程

```sql
DELIMITER //

CREATE PROCEDURE proc_name(IN a INT, OUT b INT)
BEGIN
    SET b = a * 2;
END //

DELIMITER ;
```

调用：

```sql
CALL proc_name(10, @result);
SELECT @result;   -- 输出 20
```

---

## ✅ 2️⃣ 创建存储函数

```sql
DELIMITER //

CREATE FUNCTION func_name(a INT)
RETURNS INT
DETERMINISTIC
BEGIN
    RETURN a * 2;
END //

DELIMITER ;
```

调用：

```sql
SELECT func_name(10);   -- 输出 20
```

📘 注意：

* 必须写明 **返回值类型**（`RETURNS INT`）
* 通常加上 `DETERMINISTIC`（表示函数对同样输入必定返回相同结果）
* `RETURN` 是唯一返回出口

---

# ⚙️ 三、函数中的限制（与过程的不同）

| 限制项                    | 存储函数                                            | 存储过程    |
| ---------------------- | ----------------------------------------------- | ------- |
| 可否执行事务语句               | ❌ 不可（不允许 `COMMIT`、`ROLLBACK`）                   | ✅ 可以    |
| 可否修改表数据（INSERT/UPDATE） | ❌ 通常不允许（除非 `log_bin_trust_function_creators=1`） | ✅ 可自由修改 |
| 可否作为 SQL 表达式使用         | ✅ 可以（如 `SELECT func(x)`）                        | ❌ 不行    |
| 是否必须有返回值               | ✅ 必须有                                           | ❌ 不一定   |

---

# 💡 四、应用场景对比

| 场景          | 推荐使用 |
| ----------- | ---- |
| 执行批量数据操作    | 存储过程 |
| 执行事务逻辑（如转账） | 存储过程 |
| 只做计算、返回单个结果 | 存储函数 |
| 需要在查询语句中使用  | 存储函数 |
| 实现复杂业务逻辑    | 存储过程 |

---

# 🧮 五、示例对比

### 🌟 存储过程：转账操作

```sql
DELIMITER //

CREATE PROCEDURE transfer(IN from_id INT, IN to_id INT, IN amount DECIMAL(10,2))
BEGIN
    DECLARE from_balance DECIMAL(10,2);

    START TRANSACTION;

    SELECT balance INTO from_balance FROM account WHERE id = from_id;

    IF from_balance < amount THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '余额不足';
    ELSE
        UPDATE account SET balance = balance - amount WHERE id = from_id;
        UPDATE account SET balance = balance + amount WHERE id = to_id;
    END IF;

    COMMIT;
END //

DELIMITER ;
```

📌 用法：

```sql
CALL transfer(1, 2, 100);
```

---

### 🌟 存储函数：计算折扣价

```sql
DELIMITER //

CREATE FUNCTION discount(price DECIMAL(10,2), rate DECIMAL(3,2))
RETURNS DECIMAL(10,2)
DETERMINISTIC
BEGIN
    RETURN price * (1 - rate);
END //

DELIMITER ;
```

📌 用法：

```sql
SELECT name, price, discount(price, 0.2) AS discount_price FROM goods;
```

---

# 🧩 六、查看与删除

| 操作   | 存储过程                               | 存储函数                              |
| ---- | ---------------------------------- | --------------------------------- |
| 查看列表 | `SHOW PROCEDURE STATUS;`           | `SHOW FUNCTION STATUS;`           |
| 查看定义 | `SHOW CREATE PROCEDURE proc_name;` | `SHOW CREATE FUNCTION func_name;` |
| 删除   | `DROP PROCEDURE proc_name;`        | `DROP FUNCTION func_name;`        |

---

# 📋 七、总结对比表

| 项目          | 存储过程               | 存储函数               |
| ----------- | ------------------ | ------------------ |
| 调用方式        | `CALL name()`      | 直接 `SELECT name()` |
| 返回方式        | `OUT` / `INOUT` 参数 | `RETURN`           |
| 返回值个数       | 多个                 | 一个                 |
| 是否参与 SELECT | 否                  | 是                  |
| 是否允许事务控制    | 是                  | 否                  |
| 是否能修改数据表    | 是                  | 限制较多               |
| 适合场景        | 批量操作、事务逻辑          | 计算或格式化数据           |

---

是否希望我接下来帮你写一份
👉 **「存储过程 vs 存储函数」的实战示例合集（含 SQL 模板）**？
比如包括“注册用户过程 + 校验用户名函数”这种搭配示例，一次性看懂两者协作用法。
