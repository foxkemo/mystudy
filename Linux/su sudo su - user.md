好的，我们来详细梳理一下 **`su` 和 `sudo` 的区别**，尤其关注 **环境变量和用户继承**方面：

---

## 1️⃣ 基本功能区别

| 命令     | 功能                                        | 用户切换方式                                     |
| ------ | ----------------------------------------- | ------------------------------------------ |
| `su`   | **Switch User**：切换到另一个用户（默认 root）         | 需要输入目标用户密码，完全切换用户上下文                       |
| `sudo` | **Super User Do**：以另一个用户身份执行单条命令（默认 root） | 使用当前用户密码（需在 `/etc/sudoers` 授权），不切换整个 shell |

---

## 2️⃣ 用户继承差异

* **`su`**

  * 切换用户后，程序的 **UID 和 GID** 都变为目标用户。
  * 所有后续命令都在目标用户权限下运行。
  * 如果加了 `-`（`su -`），还会加载目标用户的 **登录环境**（环境变量、路径等）。

* **`sudo`**

  * 只改变 **命令执行时的有效 UID**（EUID）为目标用户（通常是 root），**真实 UID**（RUID）仍是当前用户。
  * 仅对指定命令生效，执行完毕后回到原用户。

---

## 3️⃣ 环境变量处理差异

| 命令             | 环境变量特点                                                                                       |
| -------------- | -------------------------------------------------------------------------------------------- |
| `su username`  | 不加 `-`：保留当前用户的环境变量（PATH、HOME 等未切换），只是 UID/GID 变了。<br>加 `-`：完全模拟目标用户登录环境，PATH、HOME、SHELL 都切换。 |
| `sudo command` | 默认会保留部分当前用户的环境变量，关键变量（PATH、HOME）可能按 sudo 配置重置。<br>`sudo -i` 可以模拟登录 shell，加载目标用户环境。           |

**示例：**

```bash
# 当前用户
echo $HOME  # /home/user

# 使用 su 切换 root
su -c 'echo $HOME' root  # /root

# 使用 sudo 执行
sudo -i 'echo $HOME'  # /root
sudo 'echo $HOME'      # /home/user（默认保留环境）
```

---

## 4️⃣ 使用场景

* **`su`**

  * 想进入另一个用户完整 shell，调试或运行多条命令。
  * 需要知道目标用户密码。

* **`sudo`**

  * 临时以 root 或其他用户执行单条命令。
  * 更安全，可以限制命令范围，操作可审计。

---

总结：

* **`su` → 完全切换用户**，继承目标用户环境（加 `-`）
* **`sudo` → 临时提升权限**，只改变命令的有效 UID，原用户环境部分保留
* 环境变量和 UID/GID 的继承是两者的主要区别

---

如果你愿意，我可以画一张 **`su` vs `sudo` 用户和环境变量继承示意图**，一眼就能看懂两者差异。

你希望我画吗？