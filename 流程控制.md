非常好 👍
你提到的 **“存储过程的流程函数”**，在 MySQL 中其实指的是 **控制流程语句（Flow Control Statements）**，
也就是类似于编程语言里的 `if`、`while`、`for`、`case`、`loop` 等语句。


这些语句让 **存储过程（Stored Procedure）** 能像真正的程序一样执行逻辑判断、循环、跳转。

---

# 🧩 一、MySQL 存储过程的主要流程控制语句

| 类型      | 关键字                                   | 作用             |
| ------- | ------------------------------------- | -------------- |
| 条件判断    | `IF ... THEN ... ELSE`                | 根据条件执行不同 SQL   |
| 多分支判断   | `CASE ... WHEN ... THEN ... END CASE` | 多种条件分支         |
| 循环结构    | `WHILE` / `REPEAT` / `LOOP`           | 重复执行逻辑         |
| 跳出循环    | `LEAVE`                               | 类似于 `break`    |
| 继续下一次循环 | `ITERATE`                             | 类似于 `continue` |
| 异常处理    | `DECLARE HANDLER`                     | 捕获 SQL 异常或警告   |

---

## 🧠 二、IF 条件语句

### ✅ 基本语法：

```sql
IF condition THEN
    statements;
ELSEIF another_condition THEN
    statements;
ELSE
    statements;
END IF;
```

### 🌰 示例：

```sql
CREATE PROCEDURE check_age(IN age INT)
BEGIN
    IF age >= 18 THEN
        SELECT '成年人';
    ELSEIF age >= 12 THEN
        SELECT '青少年';
    ELSE
        SELECT '儿童';
    END IF;
END;
```

---

## 🎯 三、CASE 多分支语句

### ✅ 语法一（值匹配）：

```sql
CASE variable
    WHEN value1 THEN statements;
    WHEN value2 THEN statements;
    ELSE statements;
END CASE;
```

### ✅ 语法二（条件判断）：

```sql
CASE
    WHEN condition1 THEN statements;
    WHEN condition2 THEN statements;
    ELSE statements;
END CASE;
```

### 🌰 示例：

```sql
CREATE PROCEDURE check_score(IN score INT)
BEGIN
    CASE
        WHEN score >= 90 THEN SELECT '优秀';
        WHEN score >= 60 THEN SELECT '及格';
        ELSE SELECT '不及格';
    END CASE;
END;
```

---

## 🔁 四、WHILE 循环

### ✅ 基本语法：

```sql
WHILE condition DO
    statements;
END WHILE;
```

### 🌰 示例：累加求和

```sql
CREATE PROCEDURE sum_while(IN n INT, OUT total INT)
BEGIN
    DECLARE i INT DEFAULT 1;
    SET total = 0;
    WHILE i <= n DO
        SET total = total + i;
        SET i = i + 1;
    END WHILE;
END;
```

---

## 🔁 五、REPEAT 循环（至少执行一次）

### ✅ 基本语法：

```sql
REPEAT
    statements;
UNTIL condition
END REPEAT;
```

### 🌰 示例：

```sql
CREATE PROCEDURE sum_repeat(IN n INT, OUT total INT)
BEGIN
    DECLARE i INT DEFAULT 1;
    SET total = 0;
    REPEAT
        SET total = total + i;
        SET i = i + 1;
    UNTIL i > n
    END REPEAT;
END;
```

---

## 🔁 六、LOOP + LEAVE + ITERATE

LOOP 是最灵活的循环，需要手动退出。

```sql
label: LOOP
    statements;
    IF condition THEN
        LEAVE label;      -- 跳出循环
    END IF;
END LOOP;
```

### 🌰 示例：

```sql
CREATE PROCEDURE loop_demo()
BEGIN
    DECLARE i INT DEFAULT 1;
    test_loop: LOOP
        IF i > 5 THEN
            LEAVE test_loop;   -- 跳出循环
        END IF;
        SELECT CONCAT('i = ', i);
        SET i = i + 1;
    END LOOP test_loop;
END;
```

---

## 🚨 七、异常处理 (DECLARE HANDLER)

当 SQL 出错时自动执行指定操作（比如回滚事务或输出信息）

```sql
DECLARE EXIT HANDLER FOR SQLEXCEPTION
BEGIN
    ROLLBACK;
    SELECT '发生错误，已回滚';
END;
```

📌 常见错误类型：

| 类型             | 说明        |
| -------------- | --------- |
| `SQLEXCEPTION` | 所有 SQL 异常 |
| `SQLWARNING`   | SQL 警告    |
| `NOT FOUND`    | 查询未返回结果   |

---

## 💡 八、综合示例：转账流程

结合条件判断、循环与异常处理 👇

```sql
DELIMITER //

CREATE PROCEDURE transfer_money(IN from_id INT, IN to_id INT, IN amount DECIMAL(10,2))
BEGIN
    DECLARE from_balance DECIMAL(10,2);
    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SELECT '转账失败，已回滚';
    END;

    START TRANSACTION;

    SELECT balance INTO from_balance FROM account WHERE id = from_id;

    IF from_balance < amount THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '余额不足';
    ELSE
        UPDATE account SET balance = balance - amount WHERE id = from_id;
        UPDATE account SET balance = balance + amount WHERE id = to_id;
    END IF;

    COMMIT;
    SELECT '转账成功';
END //

DELIMITER ;
```

---

## 📋 九、总结表：流程控制关键字对照

| 控制语句                         | 作用          | 类似语言结构            |
| ---------------------------- | ----------- | ----------------- |
| `IF ... THEN ... END IF`     | 条件判断        | `if`              |
| `CASE ... WHEN ... END CASE` | 多分支选择       | `switch`          |
| `WHILE`                      | 当条件为真循环     | `while`           |
| `REPEAT`                     | 先执行后判断      | `do...while`      |
| `LOOP` + `LEAVE`             | 无条件循环（手动退出） | `for(;;){break;}` |
| `ITERATE`                    | 跳过本次循环，继续下次 | `continue`        |
| `DECLARE HANDLER`            | 异常处理机制      | `try...catch`     |

---

是否希望我给你整理一个「**流程控制语句速查模板合集**」，
每种结构都提供一个简洁可直接改用的模板（适合你写复杂存储过程时快速套用）？
