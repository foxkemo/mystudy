好的，我们来系统讲解一下 **MySQL 全局锁**（Global Lock）的概念、作用及使用方法。

---

## 1️⃣ 什么是全局锁

* **全局锁（Global Lock）**：锁住整个数据库实例或整个表空间的操作权限，而不仅仅是单表或单行。
* 作用：

  1. **保证数据一致性**（例如备份期间防止写入）
  2. **控制全局写操作**，防止其他事务修改数据
  3. **配合备份或特殊运维操作**使用

> 注意：MySQL 不同存储引擎对全局锁的支持方式不同。InnoDB 常用的是 **全局表锁**，MyISAM 有 `FLUSH TABLES WITH READ LOCK`。

---

## 2️⃣ MySQL 中的全局锁命令

### 2.1 锁定全局写操作

```sql
FLUSH TABLES WITH READ LOCK;
```

* **作用**：

  1. 锁住所有数据库表，禁止写操作（INSERT/UPDATE/DELETE/ALTER）
  2. 允许 **读取操作**（SELECT）
  3. 主要用于 **物理备份**（如 `mysqldump`、复制数据）
* **注意**：

  * 仅在当前会话释放锁之前有效
  * 其他会话的写操作会阻塞，读操作正常
* **释放锁**：

```sql
UNLOCK TABLES;
```

---

### 2.2 适用于 InnoDB

* InnoDB 是 MVCC 存储引擎，普通事务的 **读写互不阻塞**。
* 如果想做全局写保护，可以配合：

  * `FLUSH TABLES WITH READ LOCK`
  * 或者通过 **锁定所有表**：

```sql
LOCK TABLES t1 READ, t2 READ, t3 READ;
-- 执行备份或查询操作
UNLOCK TABLES;
```

> 注意：这种方式是表级锁组合实现全局锁，适合小型备份。

---

## 3️⃣ 使用场景

| 场景    | 说明                  |
| ----- | ------------------- |
| 备份    | 物理备份时，防止数据被修改，保证一致性 |
| 数据迁移  | 导出或迁移期间，阻止写操作       |
| 复制初始化 | 主从复制同步数据前，保证快照一致性   |

---

## 4️⃣ 注意事项

1. **影响性能**：全局锁会阻塞写操作，长时间加锁可能影响应用。
2. **InnoDB 的 MVCC**：InnoDB 单表或事务可以通过 MVCC 避免全局锁，但备份场景下仍需锁表保证一致性。
3. **锁释放**：

   * 会话断开或执行 `UNLOCK TABLES` 会释放
   * 使用 `FLUSH TABLES WITH READ LOCK` 时，必须保持会话连接直到备份完成

---

✅ **总结**：

* **全局锁 = 整个实例或所有表的写锁**
* **MySQL 使用场景**：

  * 备份（`FLUSH TABLES WITH READ LOCK`）
  * 数据迁移
  * 复制初始化
* **释放方式**：

  * `UNLOCK TABLES`
  * 会话断开

---

如果你需要，我可以画一张 **全局锁对其他事务读写影响的时序图**，让你直观理解它的作用。

你希望我画吗？
